<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>/auth/oAuthToken - Just the Docs Template</title> <link rel="shortcut icon" href="/favicon.png" type="image/png"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/victormono@latest/dist/index.min.css"> <!-- --> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <script src="/assets/js/web-workers/authenticator-timing.js"></script> <script src="/assets/js/simple-storage.js"></script> <script src="/assets/js/authenticator.js"></script> <script src="/assets/js/try-box.js"></script> <script src="/assets/js/callout.js"></script> <script src="/assets/js/websocket.js"></script> <script src="/assets/js/stupid-global-events.js"></script> <!-- <script src="https://cdn.jsdelivr.net/npm/device-uuid@1.0.4/index.min.js"></script> --> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>/auth/oAuthToken | Just the Docs Template</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="/auth/oAuthToken" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A starter template for a Jeykll site using the Just the Docs theme!" /> <meta property="og:description" content="A starter template for a Jeykll site using the Just the Docs theme!" /> <link rel="canonical" href="http://localhost:4000/all-ops/auth/oauthtoken" /> <meta property="og:url" content="http://localhost:4000/all-ops/auth/oauthtoken" /> <meta property="og:site_name" content="Just the Docs Template" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="/auth/oAuthToken" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A starter template for a Jeykll site using the Just the Docs theme!","headline":"/auth/oAuthToken","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/tradovate-negative.svg"}},"url":"http://localhost:4000/all-ops/auth/oauthtoken"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Just the Docs Template"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Tradovate API</a></li><li class="nav-list-item"><a href="/getting-started" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="/architecture-overview" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in REST Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/rest-guide/" class="nav-list-link">REST Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/rest-guide/access-token-request/" class="nav-list-link">Requesting API Access</a></li><li class="nav-list-item"><a href="/rest-guide/construct-headers/" class="nav-list-link">Constructing HTTP Headers</a></li><li class="nav-list-item"><a href="/rest-guide/device-id/" class="nav-list-link">How to Use Device IDs</a></li><li class="nav-list-item"><a href="/rest-guide/renewing-access/" class="nav-list-link">Renewing Your Access Token</a></li><li class="nav-list-item"><a href="/rest-guide/place-an-order/" class="nav-list-link">Place An Order</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in The Entity System category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/entity-system/" class="nav-list-link">The Entity System</a><ul class="nav-list"><li class="nav-list-item"><a href="/entity-system/entities-are-related/" class="nav-list-link">Entities are Related</a></li><li class="nav-list-item"><a href="/entity-system/shared-ops/" class="nav-list-link">Common Operations</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Entities Index category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/entity-system/entity-index/" class="nav-list-link">Entities Index</a><ul class="nav-list"><li class="nav-list-item"> <a href="/entity-system/entity-index/accesstokenresponse" class="nav-list-link">AccessTokenResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/account" class="nav-list-link">Account</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/accountriskstatus" class="nav-list-link">AccountRiskStatus</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/cashbalance" class="nav-list-link">CashBalance</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/cashbalancelog" class="nav-list-link">CashBalanceLog</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/cashbalancesnapshot" class="nav-list-link">CashBalanceSnapshot</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/checkreplaysessionresponse" class="nav-list-link">CheckReplaySessionResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/command" class="nav-list-link">Command</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/commandreport" class="nav-list-link">CommandReport</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/commandresult" class="nav-list-link">CommandResult</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/contactinfo" class="nav-list-link">ContactInfo</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/contract" class="nav-list-link">Contract</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/contractgroup" class="nav-list-link">ContractGroup</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/contractmargin" class="nav-list-link">ContractMargin</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/contractmaturity" class="nav-list-link">ContractMaturity</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/currency" class="nav-list-link">Currency</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/currencyrate" class="nav-list-link">CurrencyRate</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/deleteresultresponse" class="nav-list-link">DeleteResultResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/entitlement" class="nav-list-link">Entitlement</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/entitlementsubscription" class="nav-list-link">EntitlementSubscription</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/entitlementsubscriptionresponse" class="nav-list-link">EntitlementSubscriptionResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/executionreport" class="nav-list-link">ExecutionReport</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/fill" class="nav-list-link">Fill</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/fillfee" class="nav-list-link">FillFee</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/fillpair" class="nav-list-link">FillPair</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/marginsnapshot" class="nav-list-link">MarginSnapshot</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/order" class="nav-list-link">Order</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/orderstrategy" class="nav-list-link">OrderStrategy</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/orderstrategylink" class="nav-list-link">OrderStrategyLink</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/orderstrategystatusresponse" class="nav-list-link">OrderStrategyStatusResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/orderstrategytype" class="nav-list-link">OrderStrategyType</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/orderversion" class="nav-list-link">OrderVersion</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/placeocoresult" class="nav-list-link">PlaceOcoResult</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/placeorderresult" class="nav-list-link">PlaceOrderResult</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/placeosoresult" class="nav-list-link">PlaceOsoResult</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/position" class="nav-list-link">Position</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/product" class="nav-list-link">Product</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/productfeeparamsresponse" class="nav-list-link">ProductFeeParamsResponse</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/productmargin" class="nav-list-link">ProductMargin</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/productsession" class="nav-list-link">ProductSession</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/restrainedorderversion" class="nav-list-link">RestrainedOrderVersion</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/tradedate" class="nav-list-link">TradeDate</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/tradetime" class="nav-list-link">TradeTime</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/tradingpermission" class="nav-list-link">TradingPermission</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/tradovatesubscription" class="nav-list-link">TradovateSubscription</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/user" class="nav-list-link">User</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/useraccountautoliq" class="nav-list-link">UserAccountAutoLiq</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/useraccountpositionlimit" class="nav-list-link">UserAccountPositionLimit</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/useraccountriskparameter" class="nav-list-link">UserAccountRiskParameter</a> </li><li class="nav-list-item"> <a href="/entity-system/entity-index/userplugin" class="nav-list-link">UserPlugin</a> </li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in WebSocket Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/wss-guide/" class="nav-list-link">WebSocket Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/wss-guide/message-protocol" class="nav-list-link">Message Protocol</a></li><li class="nav-list-item"><a href="/wss-guide/heartbeats" class="nav-list-link">Heartbeats</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Market Replay category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/wss-guide/market-replay" class="nav-list-link">Market Replay</a><ul class="nav-list"><li class="nav-list-item"> <a href="/wss-guide/market-replay/change-speed" class="nav-list-link">replay/changeSpeed</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-replay/check-replay-session" class="nav-list-link">replay/checkReplaySession</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-replay/initialize-clock" class="nav-list-link">replay/initializeClock</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Realtime Market Data category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/wss-guide/market-data" class="nav-list-link">Realtime Market Data</a><ul class="nav-list"><li class="nav-list-item"> <a href="/wss-guide/market-data/cancel-chart" class="nav-list-link">md/cancelChart</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/getchart" class="nav-list-link">md/getChart</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/subscribe-dom" class="nav-list-link">md/subscribeDOM</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/subscribe-histogram" class="nav-list-link">md/subscribeHistogram</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/subscribe-quote" class="nav-list-link">md/subscribeQuote</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/unsubscribe-dom" class="nav-list-link">md/unsubscribeDOM</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/unsubscribe-histogram" class="nav-list-link">md/unsubscribeHistogram</a> </li><li class="nav-list-item"> <a href="/wss-guide/market-data/unsubscribe-quote" class="nav-list-link">md/unsubscribeQuote</a> </li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Operations category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops" class="nav-list-link">API Operations</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Accounting category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/account" class="nav-list-link">Accounting</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/cashbalance/getcashbalancesnapshot" class="nav-list-link">/account/getCashBalanceSnapshot</a> </li><li class="nav-list-item"> <a href="/all-ops/account/resetdemoaccountstate" class="nav-list-link">/account/resetDemoAccountState</a> </li><li class="nav-list-item"> <a href="/all-ops/cashbalance/changedemobalance" class="nav-list-link">/cashBalance/changeDemoBalance</a> </li><li class="nav-list-item"> <a href="/all-ops/fundtransaction/adjustcash" class="nav-list-link">/fundTransaction/adjustCash</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Alerts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/alert" class="nav-list-link">Alerts</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/adminalertsignal/completealertsignal" class="nav-list-link">/adminAlertSignal/completeAlertSignal</a> </li><li class="nav-list-item"> <a href="/all-ops/alert/createalert" class="nav-list-link">/alert/createAlert</a> </li><li class="nav-list-item"> <a href="/all-ops/contactinfo/updatecontactinfo" class="nav-list-link">/contactInfo/updateContactInfo</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Auth category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/auth" class="nav-list-link">Auth</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/auth/accesstokenrequest" class="nav-list-link">/auth/accesstokenrequest</a> </li><li class="nav-list-item"> <a href="/all-ops/auth/me" class="nav-list-link">/auth/me</a> </li><li class="nav-list-item"> <a href="/all-ops/auth/oauthtoken" class="nav-list-link">/auth/oAuthToken</a> </li><li class="nav-list-item"> <a href="/all-ops/auth/renewaccesstoken" class="nav-list-link">/auth/renewAccessToken</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Cash Balance category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/cashbalance" class="nav-list-link">Cash Balance</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Contract Library category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/contract" class="nav-list-link">Contract Library</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/contract/getproductfeeparams" class="nav-list-link">/contract/getProductFeeParams</a> </li><li class="nav-list-item"> <a href="/all-ops/contract/rollcontract" class="nav-list-link">/contract/rollContract</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Orders category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/order" class="nav-list-link">Orders</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/order/cancelorder" class="nav-list-link">/order/cancelOrder</a> </li><li class="nav-list-item"> <a href="/all-ops/order/liquidateposition" class="nav-list-link">/order/liquidatePosition</a> </li><li class="nav-list-item"> <a href="/all-ops/order/modifyorder" class="nav-list-link">/order/modifyOrder</a> </li><li class="nav-list-item"> <a href="/all-ops/order/placeoco" class="nav-list-link">/order/placeOCO</a> </li><li class="nav-list-item"> <a href="/all-ops/order/placeoso" class="nav-list-link">/order/placeOSO</a> </li><li class="nav-list-item"> <a href="/all-ops/order/placeorder" class="nav-list-link">/order/placeOrder</a> </li><li class="nav-list-item"> <a href="/all-ops/orderstrategy/interruptorderstrategy" class="nav-list-link">/orderStrategy/interruptOrderStrategy</a> </li><li class="nav-list-item"> <a href="/all-ops/orderstrategy/modifyorderstrategy" class="nav-list-link">/orderStrategy/modifyOrderStrategy</a> </li><li class="nav-list-item"> <a href="/all-ops/orderstrategy/startorderstrategy" class="nav-list-link">/orderStrategy/startOrderStrategy</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Risks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/risks" class="nav-list-link">Risks</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/useraccountautoliq/update" class="nav-list-link">/userAccountAutoLiq/update</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/useraccountpositionlimit/create" class="nav-list-link">/userAccountPositionLimit/create</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/deleteuseraccountpositionlimit" class="nav-list-link">/userAccountPositionLimit/deleteUserAccountPositionLimit</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/deleteuseraccountriskparameter" class="nav-list-link">/userAccountPositionLimit/deleteUserAccountRiskParameter</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/useraccountpositionlimitupdate" class="nav-list-link">/userAccountPositionLimit/update</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/useraccountriskparametercreate" class="nav-list-link">/userAccountRiskParameter/create</a> </li><li class="nav-list-item"> <a href="/all-ops/risks/useraccountriskparameterupdate" class="nav-list-link">/userAccountRiskParameter/update</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Shared category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/shared" class="nav-list-link">Shared</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/shared/deps" class="nav-list-link">/deps</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/find" class="nav-list-link">/find</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/item" class="nav-list-link">/item</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/items" class="nav-list-link">/items</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/ldeps" class="nav-list-link">/ldeps</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/list" class="nav-list-link">/list</a> </li><li class="nav-list-item"> <a href="/all-ops/shared/suggest" class="nav-list-link">/suggest</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Users category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/user" class="nav-list-link">Users</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/user/addmarketdatasubscription" class="nav-list-link">/user/addMarketDataSubscription</a> </li><li class="nav-list-item"> <a href="/all-ops/user/addtradovatesubscription" class="nav-list-link">/user/addTradovateSubscription</a> </li><li class="nav-list-item"> <a href="/all-ops/user/canceleverything" class="nav-list-link">/user/cancelEverything</a> </li><li class="nav-list-item"> <a href="/all-ops/user/canceltradovatesubscription" class="nav-list-link">/user/cancelTradovateSubscription</a> </li><li class="nav-list-item"> <a href="/all-ops/user/changepluginpermission" class="nav-list-link">/user/changePluginPermission</a> </li><li class="nav-list-item"> <a href="/all-ops/user/createtradingpermission" class="nav-list-link">/user/createTradingPermission</a> </li><li class="nav-list-item"> <a href="/all-ops/user/opendemoaccount" class="nav-list-link">/user/openDemoAccount</a> </li><li class="nav-list-item"> <a href="/all-ops/user/requesttradingpermission" class="nav-list-link">/user/requestTradingPermission</a> </li><li class="nav-list-item"> <a href="/all-ops/user/revoketradingpermission" class="nav-list-link">/user/revokeTradingPermission</a> </li><li class="nav-list-item"> <a href="/all-ops/user/revoketradingpermissions" class="nav-list-link">/user/revokeTradingPermissions</a> </li><li class="nav-list-item"> <a href="/all-ops/user/signuporganizationmember" class="nav-list-link">/user/signupOrganizationMember</a> </li><li class="nav-list-item"> <a href="/all-ops/userplugin/addentitlementsubscription" class="nav-list-link">/userPlugin/addEntitlementSubscription</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in WebSockets category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/all-ops/websockets" class="nav-list-link">WebSockets</a><ul class="nav-list"><li class="nav-list-item"> <a href="/all-ops/websockets/play" class="nav-list-link">WebSocket Playground</a> </li><li class="nav-list-item"> <a href="/all-ops/websockets/auth" class="nav-list-link">Authorization Procedure</a> </li><li class="nav-list-item"> <a href="/all-ops/websockets/messages" class="nav-list-link">Listen to Message Events</a> </li><li class="nav-list-item"> <a href="/all-ops/websockets/syncRequest" class="nav-list-link">user/syncRequest</a> </li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API FAQ category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/api-faq" class="nav-list-link">API FAQ</a><ul class="nav-list"><li class="nav-list-item"><a href="/api-faq/how-is-the-tradovate-api-partitioned" class="nav-list-link">How is the Tradovate API Partitioned</a></li><li class="nav-list-item"><a href="/api-faq/how-to-handle-data-size-limits" class="nav-list-link">How to Handle Data Size Limits</a></li><li class="nav-list-item"><a href="/api-faq/how-to-handle-request-size-limits" class="nav-list-link">How to Handle Request Size Limits</a></li><li class="nav-list-item"><a href="/api-faq/rest-vs-wss" class="nav-list-link">REST API vs. WebSocket API</a></li></ul></li><li class="nav-list-item"><a href="/resources/" class="nav-list-link">Resources</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Just the Docs Template" aria-label="Search Just the Docs Template" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/all-ops">API Operations</a></li> <li class="breadcrumb-nav-list-item"><a href="/all-ops/auth">Auth</a></li> <li class="breadcrumb-nav-list-item"><span>/auth/oAuthToken</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="using-oauth-for-your-tradovate-applications-authentication"> <a href="#using-oauth-for-your-tradovate-applications-authentication" class="anchor-heading" aria-labelledby="using-oauth-for-your-tradovate-applications-authentication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using OAuth for Your Tradovate Application’s Authentication </h1> <p>In this short tutorial, we will cover using the OAuth service to authenticate users for your application. Authenticating your application via OAuth for Tradovate is a three step process.</p> <ol> <li>We navigate to a special OAuth URL using our client id and client secret, which will be supplied by Tradovate. We present our Tradovate credentials here.</li> <li>After presenting our credentials, we will be redirected to a supplied redirect URL, but a single-use code will be in the URL query. Our server must extract the code from the query so we can use it in step 3.</li> <li>We exchange the extracted code for our access token, and we are officially an authenticated entity.</li> </ol> <h1 id="getting-setup"> <a href="#getting-setup" class="anchor-heading" aria-labelledby="getting-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Setup </h1> <p>We will be starting this project from scratch, however the complete solution is also provided in this repo so feel free to run it. If you’re following along from scratch, boot up a command terminal and navigate to a directory of your choosing. Run the following commands:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>oauth-example
<span class="nb">cd </span>oauth-example
yarn init
</code></pre></div></div> <p>Follow the prompts after <code class="language-plaintext highlighter-rouge">init</code>. There’s nothing wrong with simply using the defaults. We will need some utilities to help us complete this project. Let’s add those as well:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add dotenv express express-session node-cache request request-promise-native
</code></pre></div></div> <p>This seems like a lot, but it’s actually quite bare-bones.</p> <ul> <li><code class="language-plaintext highlighter-rouge">dotenv</code> allows us to store some variables locally. I’ll be using it to show how to hide our client secret.</li> <li><code class="language-plaintext highlighter-rouge">express</code> and <code class="language-plaintext highlighter-rouge">express-session</code> are mainstream server-components. Express gives our server typical routing capabilities. <code class="language-plaintext highlighter-rouge">express-session</code> allows us to use user-specific session data in our express routes.</li> <li><code class="language-plaintext highlighter-rouge">node-cache</code> is a simple stand-in for a database (for our dev purposes, in reality use a database).</li> <li>Finally <code class="language-plaintext highlighter-rouge">request</code> and <code class="language-plaintext highlighter-rouge">request-promise-native</code> allow us to send requests from the backend asynchronously like we would on the front end.</li> </ul> <p>Now that our dependencies are in order, let’s add our environment variables file. Create a new file called <code class="language-plaintext highlighter-rouge">.env</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CLIENT_ID=1
CLIENT_SECRET='your_client_secret'
</code></pre></div></div> <p>Replace the values with your special client variables, provided to you by Tradovate.</p> <p>Next we’ll add our <code class="language-plaintext highlighter-rouge">index.js</code> file:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//index.js</span>
<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nf">config</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">request-promise-native</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">NodeCache</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-cache</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express-session</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">3030</span>

<span class="c1">//this is a replacement for a database in this example. </span>
<span class="c1">//Use a database or some storage solution in a real world app.</span>
<span class="kd">const</span> <span class="nx">all_tokens</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NodeCache</span><span class="p">({</span> <span class="na">deleteOnExpire</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>

<span class="c1">//in order to use process.env, we must also create a .env file. </span>
<span class="c1">//This is not included in the example code for security reasons. </span>
<span class="c1">//See the tutorial for details on how to format the variables in the .env file.</span>
<span class="kd">const</span> <span class="nx">CLIENT_ID</span>     <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLIENT_ID</span>
<span class="kd">const</span> <span class="nx">CLIENT_SECRET</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLIENT_SECRET</span>
<span class="kd">const</span> <span class="nx">REDIRECT_URI</span>  <span class="o">=</span> <span class="s2">`http://localhost:3030/oauth/tradovate/callback`</span>
<span class="kd">const</span> <span class="nx">EXCHANGE_URL</span>  <span class="o">=</span> <span class="s2">`https://live.tradovateapi.com/auth/oauthtoken`</span>
<span class="kd">const</span> <span class="nx">AUTH_URL</span>      <span class="o">=</span> <span class="s2">`https://trader.tradovate.com/oauth`</span>

<span class="c1">// ROUTES ---------------------------------------------------------------------</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;h2&gt;Tradovate OAuth&lt;/h2&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1">// ENTRY ----------------------------------------------------------------------</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Starting your app on http://localhost:</span><span class="p">${</span><span class="nx">PORT</span><span class="p">}</span><span class="s2">`</span><span class="p">))</span>

</code></pre></div></div> <p>We import our dependencies using the standard node <code class="language-plaintext highlighter-rouge">require</code>. We’ll be using port 3030 for our examples. We also initialize our node-cache database stand-in. Then we pull our data from the <code class="language-plaintext highlighter-rouge">.env</code> file using node’s <code class="language-plaintext highlighter-rouge">process.env</code> property. This allows us to obfuscate our client id and client secret - if you add <code class="language-plaintext highlighter-rouge">.env</code> to your <code class="language-plaintext highlighter-rouge">.gitignore</code> ledger, it won’t even show up on github. Now nobody can steal our credentials.</p> <p>In the <code class="language-plaintext highlighter-rouge">ROUTES</code> section, we setup a simple home route that just sends back an HTML heading with our title inside. We will use this route later to fork our login logic, but for now this will suffice. Finally, we start the app up by <code class="language-plaintext highlighter-rouge">listen</code>ing on port 3030.</p> <p>To run the app, we could call <code class="language-plaintext highlighter-rouge">node index.js</code> from the terminal. But if you’d rather call <code class="language-plaintext highlighter-rouge">yarn start</code>, add this script to your <code class="language-plaintext highlighter-rouge">package.json</code>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
<span class="c1">//...</span>
    <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node index.js</span><span class="dl">"</span>
    <span class="p">},</span>
<span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now we can start our app by calling <code class="language-plaintext highlighter-rouge">yarn start</code>. We should see ‘Starting your app on http://localhost:3030’ logged to the terminal, and navigating to <code class="language-plaintext highlighter-rouge">localhost:3030</code> should yield your ‘Tradovate OAuth’ heading if it works.</p> <h1 id="starting-the-oauth-flow"> <a href="#starting-the-oauth-flow" class="anchor-heading" aria-labelledby="starting-the-oauth-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starting the OAuth Flow </h1> <p>In order to start the OAuth flow, we must first redirect our users to a constructed OAuth link. This link needs to contain our client id and a redirect URI - the URI for our server’s OAuth callback. Let’s build our URL now:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//construct our authorization code request URL</span>
<span class="kd">const</span> <span class="nx">authUrl</span> <span class="o">=</span>
    <span class="nx">AUTH_URL</span> 
    <span class="o">+</span> <span class="s2">`?response_type=code`</span> 
    <span class="o">+</span> <span class="s2">`&amp;client_id=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">CLIENT_ID</span><span class="p">)}</span><span class="s2">`</span> 
    <span class="o">+</span> <span class="s2">`&amp;redirect_uri=</span><span class="p">${</span><span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">REDIRECT_URI</span><span class="p">)}</span><span class="s2">`</span>

</code></pre></div></div> <p>Now we need to change our route code. Add a new route for <code class="language-plaintext highlighter-rouge">'/auth'</code>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/auth</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="nx">authUrl</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div> <p>We perform a simple redirect to our constructed <code class="language-plaintext highlighter-rouge">authUrl</code>. Then in the <code class="language-plaintext highlighter-rouge">'/'</code> route:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;h2&gt;Tradovate OAuth&lt;/h2&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;a href="/auth"&gt;&lt;h3&gt;Click to Authenticate&lt;/h3&gt;&lt;/a&gt;) //&lt;-- add this link

    res.end() 
})
</span></code></pre></div></div> <p>We’ve added an anchor element to our response HTML that will hit the <code class="language-plaintext highlighter-rouge">'/auth'</code> endpoint that we just created.</p> <h1 id="the-callback"> <a href="#the-callback" class="anchor-heading" aria-labelledby="the-callback"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Callback </h1> <p>When we run the code we created, our flow will go like this:</p> <ul> <li>The page loads, we hit the <code class="language-plaintext highlighter-rouge">'/'</code> endpoint. Our heading and anchor render.</li> <li>We click the anchor, which hits the <code class="language-plaintext highlighter-rouge">'/auth'</code> endpoint. This redirects us to the constructed OAuth URL.</li> <li>We see the Tradovate Login screen! So far so good. We present our credentials. And…</li> </ul> <p>Nothing ever happens. Or we get an error from express saying <code class="language-plaintext highlighter-rouge">cannot /GET</code>. That’s because we never setup a route for our callback.</p> <p>What happens when we present our Tradovate credentials is basically this - your app asks for confirmation that your web identity is accurate. If your user can satisfy the request, the client will receive a single-use code as a response. The response is sent to the <code class="language-plaintext highlighter-rouge">REDIRECT_URI</code> address that we specified at the top of the file. The actual <code class="language-plaintext highlighter-rouge">code</code> parameter comes to us in the form of the URL query. We can access this using the express Request object (any <code class="language-plaintext highlighter-rouge">req</code> parameter within in a route callback).</p> <p>Back in our <code class="language-plaintext highlighter-rouge">ROUTES</code> section, add a new route:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/oauth/tradovate/callback</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//req.query.code is the data we've extracted from the URL</span>
        <span class="kd">const</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">grant_type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">authorization_code</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">client_id</span><span class="p">:</span> <span class="nx">CLIENT_ID</span><span class="p">,</span>
            <span class="na">client_secret</span><span class="p">:</span> <span class="nx">CLIENT_SECRET</span><span class="p">,</span>
            <span class="na">redirect_uri</span><span class="p">:</span> <span class="nx">REDIRECT_URI</span><span class="p">,</span>
            <span class="na">code</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span>
        <span class="p">}</span>

        <span class="c1">//Alright we have a code. How can we exchange our credentials?</span>

    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>We use the <code class="language-plaintext highlighter-rouge">req</code> callback parameter’s <code class="language-plaintext highlighter-rouge">query</code> field to access parts of the URL query from code. If it’s there, we can easily extract it and put it into an object. We will use these <code class="language-plaintext highlighter-rouge">credentials</code> in our exchange. Now how can we go about doing that?</p> <p>We’re provided with a URL to exchange our code for a token, https://live.tradovate.com/auth/oauthtoken. We can send a POST request to that address with our <code class="language-plaintext highlighter-rouge">credentials</code> object in the request form. If all is well, we should be granted an access token. We’ll write a utility function to help us exchange our code:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">exchangeCode</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">form</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">//make a post request with our credentials as the form to the tradovate oauth token exchange endpoint</span>
        <span class="kd">const</span> <span class="nx">responseBody</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="nx">EXCHANGE_URL</span><span class="p">,</span> <span class="p">{</span> <span class="nx">form</span> <span class="p">})</span>
        
        <span class="c1">//if we got a token</span>
        <span class="kd">const</span> <span class="nx">token_data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">responseBody</span><span class="p">)</span>
        <span class="c1">//check it for errors</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">token_data</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Code Exchange Error: [</span><span class="p">${</span><span class="nx">token_data</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="s2">] </span><span class="p">${</span><span class="nx">token_data</span><span class="p">.</span><span class="nx">error_description</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="c1">//else save the token and expiry</span>
        <span class="nx">all_tokens</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">token_data</span><span class="p">.</span><span class="nx">access_token</span><span class="p">,</span> <span class="nx">token_data</span><span class="p">.</span><span class="nx">expires_in</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//catch non-internal errs</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Code Exchange failed.`</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Our <code class="language-plaintext highlighter-rouge">exchangeCode</code> function is an asynchronous function, meaning we can use it with the async/await API. It takes two parameters. <code class="language-plaintext highlighter-rouge">userId</code> is the <code class="language-plaintext highlighter-rouge">sessionID</code> field of our request. This is preset for us via <code class="language-plaintext highlighter-rouge">express-session</code> middleware that we setup in the Getting Setup section. The <code class="language-plaintext highlighter-rouge">form</code> parameter will be the <code class="language-plaintext highlighter-rouge">credentials</code> object we created in our callback route.</p> <p>We use another of our modules, the <code class="language-plaintext highlighter-rouge">request</code> module, to make our POST request. This is where we pass in our URL and our <code class="language-plaintext highlighter-rouge">form</code> parameter. We <code class="language-plaintext highlighter-rouge">try</code> to parse the response JSON. If we got a standard response, it could have one of two formats. Either we got a token and it has the <code class="language-plaintext highlighter-rouge">access_token</code> and <code class="language-plaintext highlighter-rouge">expires_in</code> fields, or we received the error form with <code class="language-plaintext highlighter-rouge">error</code> and <code class="language-plaintext highlighter-rouge">error_description</code> fields. We can account for both here. If we did have a token, we will save the token to our pseudo-database (keep in mind this cache is cleared on each restart). If there was some other unrelated error, it will be caught in the <code class="language-plaintext highlighter-rouge">catch</code> block.</p> <p>Now let’s utilize that function in our callback:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/oauth/tradovate/callback</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//req.query.code is the data we've extracted from the URL</span>
        <span class="kd">const</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">grant_type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">authorization_code</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">client_id</span><span class="p">:</span> <span class="nx">CLIENT_ID</span><span class="p">,</span>
            <span class="na">client_secret</span><span class="p">:</span> <span class="nx">CLIENT_SECRET</span><span class="p">,</span>
            <span class="na">redirect_uri</span><span class="p">:</span> <span class="nx">REDIRECT_URI</span><span class="p">,</span>
            <span class="na">code</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span>
        <span class="p">}</span>

        <span class="c1">//Now we know what to do...</span>
        <span class="c1">//exchange the retrieved code for our real token and store it</span>
        <span class="k">await</span> <span class="nf">exchangeCode</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">,</span> <span class="nx">credentials</span><span class="p">)</span>

        <span class="c1">//if all is well, we should be authorized to see the authenticated home screen now, so redirect to origin</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="s2">`/`</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>If we run the program now, we’ll have our typical flow. But when we submit our credentials, we will be redirected to the home page. There’s only one problem with that - we haven’t forked our logic for the authorized and unauthorized use cases. We’ll simply be presented with the click-to-authenticate screen again. Let’s fix that by splitting up our logic. We can write a helper to cover the case that we’re authenticated:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//write out HTML to display the result of `/me` endpoint</span>
<span class="kd">const</span> <span class="nx">showMe</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="k">await</span> <span class="nf">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://live-api-d.tradovate.com/auth/me</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">Authorization</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">accessToken</span>
        <span class="p">}</span>
    <span class="p">}))</span>

    <span class="c1">//in case of a non trivial amount of HTML, use a template file or one of node's many supported rendering engines.</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;h2&gt;Welcome, </span><span class="p">${</span><span class="nx">me</span><span class="p">.</span><span class="nx">fullName</span><span class="p">}</span><span class="s2">&lt;/h2&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;p&gt;ID: </span><span class="p">${</span><span class="nx">me</span><span class="p">.</span><span class="nx">userId</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;p&gt;email: </span><span class="p">${</span><span class="nx">me</span><span class="p">.</span><span class="nx">email</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;p&gt;verified?: </span><span class="p">${</span><span class="nx">me</span><span class="p">.</span><span class="nx">emailVerified</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;p&gt;trial?: </span><span class="p">${</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTrial</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>To determine if we’re authenticated, let’s write another helper to get our token:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//retrieve stored token by sessionID, in reality hit the database for this info (this is why we sim async for sync operation)</span>
<span class="kd">const</span> <span class="nx">getAccessToken</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">all_tokens</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Normally, you’d want to store and retrieve this info with a database, which is why I’ve chosen to simulate this as an asynchronous operation (even though accessing our cache is synchronous).</p> <p>Now we’re equipped to split our home page logic for authorized and unauthorized users:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="c1">// we're sending HTML</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;h2&gt;Tradovate OAuth&lt;/h2&gt;`</span><span class="p">)</span>

    <span class="c1">//check our token</span>
    <span class="kd">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">getAccessToken</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">)</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//I have a token! Show me `/me`</span>
        <span class="k">await</span> <span class="nf">showMe</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">//I don't have a token. Show me how to get one.</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;a href="/auth"&gt;&lt;h3&gt;Click to Authenticate&lt;/h3&gt;&lt;/a&gt;`</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">//done writing</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div> <p>If we run through our usual flow, we’ll get a response and be redirected home. Our logic should now be properly split and will show the results of <code class="language-plaintext highlighter-rouge">'/me'</code> from the Tradovate backend.</p> <h1 id="logout"> <a href="#logout" class="anchor-heading" aria-labelledby="logout"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logout </h1> <p>There’s just one loose end left to take care of. We need to add some logout logic. Let’s add one more route:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/logout</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">all_tokens</span><span class="p">.</span><span class="nf">del</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div> <p>In a real world app, you’d probably clear the token from your database. In our example we can simply delete the token associated with the client’s <code class="language-plaintext highlighter-rouge">sessionID</code>. Now we just need to add an extra line to our <code class="language-plaintext highlighter-rouge">showMe</code> function:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">showMe</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;h2&gt;Tradovate OAuth&lt;/h2&gt;`</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`&lt;a href="/logout"&gt;&lt;h3&gt;Logout&lt;/h3&gt;&lt;/a&gt;`</span><span class="p">)</span> <span class="c1">//&lt;-- add this</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div></div> <p>We can successfully logout using this new anchor after our usual flow.</p> </main> </div> </div> <div class="search-overlay"></div> </div> <div class="tdv-rightbar"></div> <script> const keySvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#bbb" viewBox="0 0 20 20"><title>key</title><path d="M15 6a1.54 1.54 0 0 1-1.5-1.5 1.5 1.5 0 0 1 3 0A1.54 1.54 0 0 1 15 6zm-1.5-5A5.55 5.55 0 0 0 8 6.5a6.81 6.81 0 0 0 .7 2.8L1 17v2h4v-2h2v-2h2l3.2-3.2a5.85 5.85 0 0 0 1.3.2A5.55 5.55 0 0 0 19 6.5 5.55 5.55 0 0 0 13.5 1z"/></svg>`; const mdSize = 800; const smSize = 500; let ratio = window.innerWidth / window.innerHeight; const isSmall = () => window.innerWidth < mdSize; const mainContent = document.querySelector('.main-content'); const search = document.querySelector('.search-input-wrap'); const TDV = Symbol.for('tdv-docs'); const SiteStorage = window[TDV].SiteStorage; const Authenticator = window[TDV].Authenticator; /*LOCK*/ const lock = document.createElement('div'); lock.id = 'tdv-lock'; lock.style.position = 'absolute'; lock.style.zIndex = 100; lock.style.top = window.innerWidth > mdSize ? `12px` : `72px`; lock.style.right = window.innerWidth > mdSize ? '64px' : `10px`; lock.style.transition = '.33s transform ease-out'; lock.style.transformOrigin = 'center'; lock.style.cursor = 'pointer'; /*OVERLAY*/ const overlay = document.createElement('div'); overlay.style.height = window.innerHeight + 'px'; overlay.style.width = window.innerWidth + 'px'; overlay.style.backgroundColor = '#0005'; overlay.style.position = 'fixed'; overlay.style.top = 0; overlay.style.left = 0; overlay.id = 'full-overlayer'; overlay.style.zIndex = 101; overlay.style.display = 'flex'; overlay.style.justifyContent = 'center'; overlay.style.alignItems = 'center'; overlay.style.transition = 'all .33ms ease-out'; /*MODAL*/ const modal = document.createElement('div'); const topBar = document.createElement('div'); const tokenInput = document.createElement('input'); const close = document.createElement('div'); const submit = document.createElement('button'); const logout = document.createElement('button'); const heading = document.createElement('h2'); const mbox = mainContent.getBoundingClientRect(); heading.innerText = 'Enter Your Access Token'; heading.style.justifySelf = 'start'; submit.id = 'submit-btn'; submit.classList.add('btn'); submit.textContent = 'Authorize'; logout.id = 'logout-btn'; logout.classList.add('btn'); logout.textContent = 'Log Out'; modal.style.zIndex = 102; modal.style.minHeight = '250px'; modal.style.height = winPercent(.3) + '%'; modal.style.width = Math.max(50, winPercent((100 - 35*ratio)/100)) + '%'; modal.classList.add('bg-grey-dk-300'); modal.style.display = 'flex'; modal.style.alignItems = 'center'; modal.style.justifyContent = 'space-evenly'; modal.style.flexDirection = 'column'; modal.style.boxShadow = '0 0 5px -2px'; modal.style.borderRadius = '4px'; modal.style.backdropFilter = 'blur(2px)'; modal.classList.add('main-content'); modal.style.transition = 'all .33ms ease-out'; const modalInnerWrapper = document.createElement('div'); modalInnerWrapper.style.height = '100%'; modalInnerWrapper.style.width = '75%'; modalInnerWrapper.style.display = 'flex'; modalInnerWrapper.style.alignItems = 'start'; modalInnerWrapper.style.justifyContent = 'space-evenly'; modalInnerWrapper.style.flexDirection = 'column'; tokenInput.type = 'text'; tokenInput.id = 'access-token-input'; tokenInput.style.backgroundColor = '#27262b'; tokenInput.style.color = 'white'; tokenInput.style.padding = '4px'; tokenInput.placeholder = '12345-abcde...'; tokenInput.style.border = 'none'; tokenInput.style.outline = 'none'; tokenInput.style.borderBottom = '1px solid grey'; tokenInput.style.height = '64px'; tokenInput.style.width = '100%'; const inputLabel = document.createElement('label'); inputLabel.style.position = 'relative'; inputLabel.style.width = '100%'; const inputKeyTag = document.createElement('svg'); inputKeyTag.innerHTML = keySvg; tokenInput.addEventListener('focusin', () => { inputKeyTag.style.transform = isSmall() ? 'scale(1.5)' : 'scale(2)'; inputKeyTag.firstElementChild.style.fill = '#f77e7e'; inputKeyTag.style.left = '-32px'; inputKeyTag.style.top = '20px'; }); tokenInput.addEventListener('focusout', () => { inputKeyTag.style.transform = isSmall() ? '' : 'scale(1.5)'; inputKeyTag.firstElementChild.style.fill = '#bbb'; inputKeyTag.style.left = '-24px'; inputKeyTag.style.top = '24px'; }); inputLabel.appendChild(inputKeyTag); inputKeyTag.style.position = 'absolute'; inputKeyTag.style.transform = isSmall() ? '' : 'scale(1.5)'; inputKeyTag.style.left = '-24px'; inputKeyTag.style.top = '24px'; inputKeyTag.style.transition = 'all .25s ease-out'; inputLabel.appendChild(tokenInput); close.style.position = 'absolute'; close.style.top = '4px'; close.style.right = '0px'; close.style.height = '48px'; close.style.width = '48px'; close.innerText = '❌'; close.style.fontSize = '20px'; close.style.cursor = 'pointer'; modalInnerWrapper.appendChild(heading); modalInnerWrapper.appendChild(inputLabel); modalInnerWrapper.appendChild(submit); modalInnerWrapper.appendChild(close); modal.appendChild(modalInnerWrapper); overlay.appendChild(modal); window.addEventListener('resize', () => { ratio = window.innerWidth / window.innerHeight; overlay.style.height = window.innerHeight + 'px'; overlay.style.width = window.innerWidth + 'px'; modal.style.height = winPercent(.3) + '%'; modal.style.width = Math.max(50, winPercent((100 - 35*ratio)/100)) + '%'; lock.style.top = window.innerWidth > mdSize ? `12px` : `72px`; lock.style.right = window.innerWidth > mdSize ? '64px' : `10px`; }); lock.addEventListener('mouseenter', _ => { lock.style.transform = 'scale(1.1)'; }); lock.addEventListener('mouseleave', _ => { lock.style.transform = 'scale(1)'; }); lock.addEventListener('click', async _ => { let result = SiteStorage.getLockedIn(); const over = document.querySelector('full-overlayer'); if(!over) { document.body.appendChild(prepOverlay(result)); } }); close.addEventListener('click', _ => { removeOverlay(); }); submit.addEventListener('click', async _ => { let maybeToken = document.getElementById('access-token-input'); await Authenticator.authenticate(maybeToken.value); if(Authenticator.isAuthenticated()) { removeOverlay(); maybeToken.style.border = 'none'; alert('API Authorization successful.'); } else { heading.textContent = 'Token Was Invalid!'; maybeToken.style.border = '1px solid red'; } }); logout.addEventListener('click', async _ => { Authenticator.logout(); removeOverlay(); }); Authenticator.setLockElement(lock); mainContent.appendChild(lock); /*UTILS*/ function removeOverlay() { let over = document.getElementById('full-overlayer'); if(over) { overlay.style.opacity = '0'; overlay.remove(); } } function prepOverlay(result) { const _submit = modalInnerWrapper.querySelector('#submit-btn'); const _logout = modalInnerWrapper.querySelector('#logout-btn'); const input = modalInnerWrapper.querySelector('input'); const key = modalInnerWrapper.querySelector('svg'); const h2 = modalInnerWrapper.querySelector('h2'); if(result) { h2.textContent = 'API Is Authorized'; if(input && key) { inputLabel.remove(); } if(_submit) { modalInnerWrapper.replaceChild(logout, submit); } else { modalInnerWrapper.appendChild(logout); } } else { h2.textContent = 'Enter Your Access Token'; if(_logout) { modalInnerWrapper.replaceChild(submit, logout); } else { modalInnerWrapper.appendChild(submit); } if(!input && !key) { tokenInput.value = ''; submit.parentElement.insertBefore(inputLabel, submit); } } overlay.style.opacity = '1'; return overlay; } function winPercent(decimalPercent) { return (((window.innerHeight * decimalPercent)/window.innerHeight)*100); } </script> </body> </html>
